<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; margin: 0; padding: 1em; background-color: #f0f2f5; }
        .container { max-width: 600px; margin: auto; background: white; padding: 2em; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1c1e21; }
        .form-group { margin-bottom: 1.5em; }
        label { display: block; margin-bottom: 0.5em; font-weight: bold; color: #4b4f56; }
        select, input[type="file"], button { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #dddfe2; font-size: 1em; font-family: 'Sarabun', sans-serif; box-sizing: border-box; }
        input[type="file"] { border: 2px dashed #dddfe2; background-color: #f7f7f7; }
        button { background-color: #1877f2; color: white; font-weight: bold; border: none; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #166fe5; }
        button:disabled { background-color: #9dbcf3; cursor: not-allowed; }
        #ocr-status { text-align: center; padding: 1em; color: #333; font-weight: bold; background-color: #e9ecef; border-radius: 5px; margin-top: 1em; display: none; }
        #result-container { margin-top: 1.5em; padding: 2em; text-align: center; border-radius: 8px; font-size: 1.5em; font-weight: bold; }
        .result-win { background-color: #d1e7dd; color: #0f5132; }
        .result-lose { background-color: #f8d7da; color: #842029; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
</head>
<body>

    <div class="container">
        <h1>‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h1>

        <div class="form-group">
            <label for="lotto-type">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏´‡∏ß‡∏¢</label>
            <select id="lotto-type">
                <option value="‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ ‡∏õ‡∏Å‡∏ï‡∏¥">‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ ‡∏õ‡∏Å‡∏ï‡∏¥</option>
                <option value="‡∏•‡∏≤‡∏ß‡∏û‡∏±‡∏í‡∏ô‡∏≤">‡∏•‡∏≤‡∏ß‡∏û‡∏±‡∏í‡∏ô‡∏≤</option>
                <option value="‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ ‡∏û‡∏¥‡πÄ‡∏®‡∏©">‡∏Æ‡∏≤‡∏ô‡∏≠‡∏¢ ‡∏û‡∏¥‡πÄ‡∏®‡∏©</option>
            </select>
        </div>

        <div class="form-group">
            <label for="lotto-image">2. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ</label>
            <input type="file" id="lotto-image" accept="image/*">
        </div>

        <button id="check-button">‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>

        <div id="ocr-status"></div>
        <div id="result-container"></div>
    </div>

    <script>
        // -----------------------------------------------------------------
        // ‚ú® ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå CSV ‡∏Ç‡∏≠‡∏á "‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" ‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤ ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚ú®
        // -----------------------------------------------------------------
        const winningSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQiBp4Z2XVrllF6aly9pAtFZexQmMfz3fHvvQQE2o5HfhtioEWj4KWTj7uXZh_xwm5Fbi336KKipD4_/pubhtml';

        const checkButton = document.getElementById('check-button');
        const imageInput = document.getElementById('lotto-image');
        const ocrStatus = document.getElementById('ocr-status');
        const resultContainer = document.getElementById('result-container');

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà OCR ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        function parseOcrText(text) {
            const bets = [];
            const lines = text.split('\n');
            for (const line of lines) {
                if (/^[\d\s]+$/.test(line.trim())) {
                    const parts = line.trim().split(/\s+/);
                    if (parts.length >= 2 && (parts[0].length === 2 || parts[0].length === 3)) {
                        bets.push({
                            number: parts[0],
                            betTop: parts[1],
                            betBottom: parts.length > 2 ? parts[2] : null,
                            betTod: parts.length > 3 ? parts[3] : null,
                        });
                    }
                }
            }
            console.log("Parsed bets:", bets);
            return bets;
        }

        // NEW: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏ï‡πä‡∏î‡πÅ‡∏ö‡∏ö "6 ‡∏Å‡∏•‡∏±‡∏ö" (6 ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô 9 ‡πÑ‡∏î‡πâ)
        function checkTodWith69Rule(userNumber, winningNumber) {
            if (!userNumber || !winningNumber || userNumber.length !== 3 || winningNumber.length !== 3) {
                return false;
            }
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç 6 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 9 ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
            const canonicalUser = userNumber.replace(/6/g, '9');
            const canonicalWinning = winningNumber.replace(/6/g, '9');

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏∏‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ô
            const sortedUser = canonicalUser.split('').sort().join('');
            const sortedWinning = canonicalWinning.split('').sort().join('');
            
            return sortedUser === sortedWinning;
        }


        async function handleCheck() {
            const lottoType = document.getElementById('lotto-type').value;
            const imageFile = imageInput.files[0];

            if (!imageFile) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }

            checkButton.disabled = true;
            ocrStatus.style.display = 'block';
            ocrStatus.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏û...';
            resultContainer.innerHTML = '';
            resultContainer.className = '';

            try {
                const worker = await Tesseract.createWorker('tha+eng');
                ocrStatus.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û... (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)';
                const { data: { text } } = await worker.recognize(imageFile);
                await worker.terminate();

                ocrStatus.textContent = '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•...';
                console.log("Raw OCR Text:", text);
                
                const userBets = parseOcrText(text);
                if (userBets.length === 0) {
                     resultContainer.innerHTML = '<p style="color:red;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ</p>';
                     return;
                }

                const response = await fetch(winningSheetUrl);
                const csvText = await response.text();
                const winningRows = csvText.split('\n');
                const headers = winningRows[0].split(',');
                
                let winningNumbers = null;
                const todayWinningRow = winningRows.slice(1).find(row => row.split(',')[headers.indexOf('LotteryName')] === lottoType);

                if (todayWinningRow) {
                    const cols = todayWinningRow.split(',');
                    winningNumbers = {
                        top3: cols[headers.indexOf('Prize3Top')]?.trim(),
                        bottom2: cols[headers.indexOf('Prize2Bottom')]?.trim(),
                    };
                } else {
                    resultContainer.className = 'result-lose';
                    resultContainer.textContent = `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "${lottoType}"`;
                    return;
                }

                // --- CHANGED: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° ---
                let hasAnyWin = false; // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏´‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

                userBets.forEach(bet => {
                    if (hasAnyWin) return; // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ï‡πà‡∏≠

                    // ‡∏ï‡∏£‡∏ß‡∏à 3 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô (‡πÄ‡∏ï‡πá‡∏á)
                    if (bet.number === winningNumbers.top3 && bet.betTop) hasAnyWin = true;
                    // ‡∏ï‡∏£‡∏ß‡∏à 2 ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á
                    if (bet.number === winningNumbers.bottom2 && bet.betBottom) hasAnyWin = true;
                    // ‡∏ï‡∏£‡∏ß‡∏à 2 ‡∏ï‡∏±‡∏ß‡∏ö‡∏ô
                    if (bet.number.length === 2 && bet.number === winningNumbers.top3?.slice(-2) && bet.betTop) hasAnyWin = true;
                    // ‡∏ï‡∏£‡∏ß‡∏à 3 ‡∏ï‡∏±‡∏ß‡πÇ‡∏ï‡πä‡∏î (‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏é 6 ‡∏Å‡∏•‡∏±‡∏ö)
                    if (bet.betTod && checkTodWith69Rule(bet.number, winningNumbers.top3)) hasAnyWin = true;
                });
                
                // --- CHANGED: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ---
                if (hasAnyWin) {
                    resultContainer.className = 'result-win';
                    resultContainer.textContent = 'üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏´‡∏ß‡∏¢ üéâ';
                } else {
                    resultContainer.className = 'result-lose';
                    resultContainer.textContent = '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏´‡∏ß‡∏¢';
                }

            } catch (error) {
                console.error(error);
                resultContainer.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•';
            } finally {
                ocrStatus.style.display = 'none';
                checkButton.disabled = false;
            }
        }
    </script>
</body>
</html>
